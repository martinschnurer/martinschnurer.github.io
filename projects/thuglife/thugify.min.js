function downloadCanvas(a,b,c){a.href=document.getElementById(b).toDataURL("image/jpeg",.7),a.download=c}function enableOptions(){$("#options").delay(400).show(400)}function getImageName(){let a="picture_";if("undefined"==typeof localStorage)return a+Date.now()/1e3+".jpg";let b=localStorage.getItem("counter");return null==localStorage.getItem("counter")&&localStorage.setItem("counter",0),localStorage.setItem("counter",parseInt(localStorage.getItem("counter"))+1),a+b+".jpg"}function fileOnload(a){$img=$("<img>",{src:a.target.result}),$img.load(function(a){$img_width=$img[0].width,$img_height=$img[0].height,this.naturalWidth>600&&($crop_ratio=600/this.naturalWidth,$img_height=this.naturalHeight*$crop_ratio,$img_width=this.naturalWidth*$crop_ratio),this.naturalHeight>600&&($crop_ratio=600/this.naturalHeight,$img_height=this.naturalHeight*$crop_ratio,$img_width=this.naturalWidth*$crop_ratio),console.log(a),canvas.setHeight($img_height),canvas.setWidth($img_width);let b={width:$img_width,height:$img_height,selectable:!1,hoverCursor:"arrow",cornerColor:"#FFF300"};mainPhoto=new fabric.Image(this,b),canvas.add(mainPhoto),enableOptions(),$("#mainTitle").hide(400)})}function loadImage(){console.log("loading image")}var canvas=new fabric.Canvas("mainCanvas"),mainPhoto=void 0,greyScale_active=!1;$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),document.getElementById("downloadImage").addEventListener("click",function(){canvas.deactivateAll().renderAll(),downloadCanvas(this,"mainCanvas",getImageName())},!1),$(".ref").click(function(){let a=$(this).attr("src");a=a.split("/")[1],fabric.Image.fromURL("./images/"+a,function(a){var b=10*Math.random(),c=10*Math.random();a.scale(.3),a.set({left:b}),a.set({top:c}),a.set("cornerColor","#FFF300"),canvas.add(a)})}),$("#showImage").click(function(a){canvas.deactivateAll().renderAll(),window.open(document.getElementsByTagName("canvas")[0].toDataURL("image/jpeg",.7),"_blank")}),$("#greyScale").click(function(){let a=canvas.getObjects(),b=new fabric.Image.filters.Grayscale;a.forEach(function(a){greyScale_active?a.filters=[]:a.filters.push(b),a.applyFilters(canvas.renderAll.bind(canvas))}),greyScale_active=!greyScale_active}),$("#chooseImage").change(function(a){var b=a.target.files[0],c=/image.*/;if(b.type.match(c)){var d=new FileReader;d.onload=fileOnload,d.readAsDataURL(b)}});
