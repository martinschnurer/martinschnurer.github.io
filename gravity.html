<html>
<head>
	<title>gravity</title>

	<style>
	body{margin:0px;left:0px;top:0px;}


	#okey{
		background-color:black;
	}

	#planeta{
		background-color: blue;
	}

	#slnko{
		background-color: yellow;
	}

	</style>
</head>
<body>

	<canvas id="okey" width=1000px height=600px></canvas>

	<script>

	var G = 6.7e-11;
	var Mz = 5.972e24;
	var Rz = 6378; //km

	function bod(x,y) {
		this.x = x;
		this.y = y;
	}

	function vector(x,y) {
		this.x = x;
		this.y = y;
	}

	function rychlost(velkost, vector) {
		this.velkost = velkost;
		this.vector = vector;
	}

	function planeta(bod,r,vector) {
		this.bod = bod;
		this.vector = vector;
		this.r = r;
		this.historyPoints = []
	}

	function scitajVector(vector1,vector2) {
		var novyvektor = new vector(0,0)
		novyvektor.x = vector1.x + vector2.x
		novyvektor.y = vector1.y + vector2.y
		return novyvektor;
	}

	function distance(bod1,bod2) {
		var dlzkax = bod1.x - bod2.x;
		var dlzkay= bod1.y - bod2.y;
		return Math.sqrt(dlzkax*dlzkax+dlzkay*dlzkay);
	}

	function velkostVektora(vektor){
		return Math.sqrt(vektor.x*vektor.x + vektor.y*vektor.y);
	}

	function vynasobVektor(vektor,cislo) {
		vektor.x = vektor.x * cislo;
		vektor.y = vektor.y * cislo
	}

	function multiplyBezierCurves(ctx, planet) {
		var i = 0,
		len = planet.historyPoints.length;
		ctx.beginPath()
		ctx.moveTo(planet.bod.x, planet.bod.y)
		while (i < len - 3) {
			ctx.strokeStyle = "white";
			ctx.lineWidth =  5 / i;
			ctx.lineTo(planet.historyPoints[i].x, planet.historyPoints[i].y)
			ctx.lineTo(planet.historyPoints[i+1].x, planet.historyPoints[i+1].y)
			ctx.lineTo(planet.historyPoints[i+2].x, planet.historyPoints[i+2].y)
			ctx.stroke()
			i += 3;
		}
		ctx.closePath()
		ctx.lineWidth = 1;
	}

	var c = document.getElementById('okey');
	var plocha = c.getContext("2d");

	plocha.translate(500,300);

	var polohaZac = new bod(0,50);
	var stred = new bod(0,0);

	var zem = new planeta(stred, 20, new vector(0,0));
	var mesiac = new planeta(polohaZac, 5, new vector(-900,0));

	plocha.beginPath()
	plocha.arc(zem.bod.x,zem.bod.y,zem.r,0,2*Math.PI)
	plocha.fillStyle = "yellow"
	plocha.stroke()
	plocha.fill()
	plocha.closePath()

	plocha.beginPath()
	plocha.arc(mesiac.bod.x, mesiac.bod.y, mesiac.r, 0, 2 * Math.PI)
	plocha.fillStyle = "blue"
	plocha.fill()
	plocha.stroke()
	plocha.closePath()



	var a;
	const dt = 0.008;
	var ax;
	var ay;
	var vx = mesiac.vector.x;
	var vy = mesiac.vector.y;

	var menovatel, vzdialenost, konst;
	var step = 0;
	function makeStep() {

		step++;

		plocha.beginPath();
			plocha.clearRect(-500,-300,1000,600);
			plocha.fillStyle = "black";
			plocha.fill();
		plocha.closePath();

		plocha.beginPath();
			plocha.arc(zem.bod.x,zem.bod.y,zem.r,0,2*Math.PI);
			plocha.fillStyle="blue";
			plocha.fill();
		plocha.closePath();

		plocha.beginPath();
			plocha.arc(mesiac.bod.x, mesiac.bod.y, mesiac.r, 0, 2 * Math.PI)
			plocha.fillStyle = "white"
			plocha.fill()
		plocha.closePath()

		plocha.beginPath()
			plocha.moveTo(mesiac.bod.x,mesiac.bod.y)
			plocha.lineTo(mesiac.bod.x + vx * 0.2, mesiac.bod.y + vy * 0.2)
			plocha.strokeStyle = "green"
			plocha.stroke()
		plocha.closePath()

		plocha.beginPath()
			plocha.moveTo(mesiac.bod.x, mesiac.bod.y)
			plocha.lineTo(mesiac.bod.x + ax*0.01, mesiac.bod.y + ay*0.01)
			plocha.strokeStyle = "red"
			plocha.stroke()
		plocha.closePath()


		//vypocet//
		menovatel = Math.pow(318900 + 1000 * distance(mesiac.bod, zem.bod), 2)

		a =  G * Mz / menovatel

		vzdialenost = distance(mesiac.bod, zem.bod)
		konst = a / vzdialenost

		/* zmena zrychlenia */
		ax = konst * (zem.bod.x - mesiac.bod.x)
		ay = konst * (zem.bod.y - mesiac.bod.y)

		/* zmena rychlosti */
		vx = vx + ax * dt
		vy = vy + ay * dt

		/* zmena polohy podla rychlosti */
		mesiac.bod.x = mesiac.bod.x + vx*dt
		mesiac.bod.y = mesiac.bod.y + vy*dt

		if (step % 2 == 0) {
			mesiac.historyPoints.unshift(new bod(mesiac.bod.x, mesiac.bod.y))
			mesiac.historyPoints.length = Math.min(500, mesiac.historyPoints.length)
		}
		multiplyBezierCurves(plocha, mesiac)

		window.requestAnimationFrame(makeStep)
	}

	makeStep()


	</script>

</body>

</html>
